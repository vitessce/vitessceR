---
title: "Usage with SingleCellExperiment"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Usage with SingleCellExperiment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The following is a full example of usage of the widget with a [SingleCellExperiment](https://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html) object.

First, install the R dependencies:

```r
install.packages("BiocManager")
BiocManager::install("scRNAseq")
BiocManager::install("scater")
```

Download the dataset, load and preprocess the SingleCellExperiment object, and configure the Vitessce widget:

```r
library(vitessceR)
library(scRNAseq)
library(scater)

sce_zeisel <- ZeiselBrainData()

sce_zeisel <- addPerCellQC(sce_zeisel, subsets=list(Mito = grep("mt-", rownames(sce_zeisel))))
sce_zeisel <- logNormCounts(sce_zeisel) 
sce_zeisel <- runPCA(sce_zeisel)


# Create Vitessce view config
vc <- VitessceConfig$new("My config")
dataset <- vc$add_dataset("My dataset")$add_object(SCEWrapper$new(
  sce_zeisel,
  assay = "logcounts",
  cell_set_metas = c("tissue", "level1class", "level2class"),
  cell_set_meta_names = c("Tissue", "Cell Type Level 1", "Cell Type Level 2"),
  cell_embeddings = c("PCA"),
  out_dir = file.path("data", "sce")
))
scatterplot_cs <- vc$add_view(dataset, Component$SCATTERPLOT, mapping = "PCA")
scatterplot_g <- vc$add_view(dataset, Component$SCATTERPLOT, mapping = "PCA")
cell_sets <- vc$add_view(dataset, Component$CELL_SETS)
genes <- vc$add_view(dataset, Component$GENES)
vc$link_views(
  list(scatterplot_cs, scatterplot_g),
  list(CoordinationType$EMBEDDING_ZOOM),
  list(0.0)
)
vc$link_views(
  list(scatterplot_cs),
  list("cellColorEncoding"),
  list("cellSetSelection")
)
vc$layout(vconcat(
  hconcat(scatterplot_cs, scatterplot_g),
  hconcat(cell_sets, genes)
))

# Render the Vitessce widget
vc$widget(theme = "light")
```
